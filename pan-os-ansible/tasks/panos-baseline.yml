  - name: debug ip
    debug:
      var:
        mgmt_ip

  - name: hash password
    panos_op:
      ip_address: '{{ mgmt_ip }}'
      username: '{{ username }}'
      password: '{{ password }}'
      cmd: 'request password-hash password "{{ password | urlencode }}"'
    register: password_result

  - name: debug password result
    debug:
      var:
        password_result

  - name: Create base configuration from template
    template:
      src: templates/panos-baseline.xml.j2
      dest: "{{ playbook_dir }}/panos-baseline.xml"

  - name: Upload base configuration
    panos_import:
      ip_address: '{{ mgmt_ip }}'
      username: '{{ username }}'
      password: '{{ password }}'
      file: "{{ playbook_dir }}/panos-baseline.xml"
      category: "configuration"
    register: result

  - name: load configuration
    panos_loadcfg:
      ip_address: '{{ mgmt_ip }}'
      username: '{{ username }}'
      password: '{{ password }}'
      file: "{{ result.filename }}"